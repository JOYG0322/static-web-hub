<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NetGauge · EasyTier 网络质量检测</title>
    <link rel="icon" type="image/svg+xml" id="favicon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232fb3ad'><path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z'/></svg>">
    <link rel="stylesheet" href="css/netgauge.css?v=2.0.0">
</head>
<body>
<div class="app">
    <div class="panel main">
        <div class="header">
            <div class="title-row">
                <div class="logo">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                </div>
                <div>
                    <h1>NetGauge · 网络质量检测</h1>
                    <div class="subtitle">EasyTier P2P 网络性能测试</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="settingsBtn" title="设置">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="score-section">
            <div class="score-card">
                <div class="score-num" id="score">—</div>
                <div class="score-text" id="scoreText">等待测试</div>
            </div>
            <div class="score-desc">
                <p>综合评分基于：公网延迟、内网延迟、带宽、丢包率</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>

        <div class="metrics-grid">
            <div class="metric">
                <div class="value" id="latencyPublic">— ms</div>
                <div class="label">公网延迟</div>
            </div>
            <div class="metric">
                <div class="value" id="latencyPrivate">— ms</div>
                <div class="label">内网延迟</div>
            </div>
            <div class="metric">
                <div class="value" id="jitter">— ms</div>
                <div class="label">网络抖动</div>
            </div>
            <div class="metric">
                <div class="value" id="download">— Mbps</div>
                <div class="label">下载带宽</div>
            </div>
            <div class="metric">
                <div class="value" id="upload">— Mbps</div>
                <div class="label">上传带宽</div>
            </div>
            <div class="metric">
                <div class="value" id="packetLoss">— %</div>
                <div class="label">丢包率</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" id="startBtn">开始测试</button>
            <button class="btn secondary" id="clearBtn">清除结果</button>
            <div class="status-text" id="statusText">就绪</div>
        </div>

        <div class="card">
            <div class="card-title">测试日志</div>
            <div class="log-container" id="logContainer"></div>
        </div>
    </div>

    <aside class="panel side">
        <div class="card">
            <div class="card-title">历史记录</div>
            <div class="history-list" id="historyList">
                <div style="color:var(--text-sub);font-size:12px;">暂无历史记录</div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">测试项目说明</div>
            <ul class="tips-list">
                <li><strong>公网延迟</strong>：测试到互联网的 RTT</li>
                <li><strong>内网延迟</strong>：测试到 EasyTier 节点的 RTT</li>
                <li><strong>下载/上传</strong>：测试 P2P 链路带宽</li>
                <li><strong>丢包率</strong>：WebSocket 回环测试</li>
            </ul>
        </div>

        <div class="card">
            <div class="card-title">注意事项</div>
            <ul class="tips-list">
                <li>需要部署后端服务才能完整测试</li>
                <li>内网测试通过 EasyTier P2P 连接</li>
                <li>结果自动保存到本地存储</li>
            </ul>
        </div>
    </aside>
</div>

<div class="settings-panel-overlay" id="settingsOverlay"></div>
<div class="settings-panel" id="settingsPanel">
    <div class="settings-panel-header">
        <h3>设置</h3>
        <button class="settings-panel-close" id="settingsClose">&times;</button>
    </div>
    <div class="settings-panel-content">
        <div class="settings-section">
            <div class="settings-section-title">服务器配置</div>
            <div class="settings-row" style="flex-direction:column;align-items:stretch;gap:8px;">
                <label class="settings-label">后端服务地址</label>
                <input type="text" id="serverUrlInput" class="settings-input" placeholder="http://10.126.126.15:8080">
                <button class="btn" id="saveServerBtn" style="width:100%;">保存配置</button>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">外观</div>
            <div class="settings-row">
                <span class="settings-label">颜色主题</span>
                <div class="theme-segment">
                    <div class="theme-segment-indicator" id="themeIndicator"></div>
                    <button class="theme-segment-btn" data-theme="dark">深色</button>
                    <button class="theme-segment-btn" data-theme="light">浅色</button>
                    <button class="theme-segment-btn" data-theme="auto">自动</button>
                </div>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">数据</div>
            <div class="settings-row">
                <span class="settings-label">历史记录</span>
                <button class="btn secondary" id="clearHistoryBtn" style="padding:6px 12px;font-size:12px;">清除历史</button>
            </div>
        </div>
    </div>
    <div class="settings-footer">
        <svg class="settings-footer-logo" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
        </svg>
        <span class="settings-footer-text">NetGauge v2.0</span>
    </div>
</div>

<script src="../assets/js/theme-manager.js?v=4.3.3"></script>
<script src="js/netgauge.js?v=2.0.6"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.querySelectorAll('.theme-segment-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === savedTheme);
    });
    
    if (window.netGauge) {
        setTimeout(() => window.netGauge.updateThemeIndicator(savedTheme), 100);
    }
    
    $('clearHistoryBtn')?.addEventListener('click', () => {
        if (confirm('确定要清除所有历史记录吗？')) {
            localStorage.removeItem('netgauge_history');
            if (window.netGauge) {
                window.netGauge.history = [];
                window.netGauge.renderHistory();
            }
        }
    });
});
</script>
</body>
</html>
